<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="/css/style.css">
  <meta charset="UTF-8">
  <meta name="description" content="Music by Christopher Leary">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="/assets/jquery.stellar.min.js"></script>
  <script>
  $(function() {
    $.stellar({
      horizontalScrolling: false
    });
  });
  </script>
  <title>Ochre | Replacing video audio using ffmpeg</title>
</head>

<body>
  <a href="/">
    <header data-stellar-background-ratio="0.5">
      <!-- <a href="/" id="site-header">Ochre</a> -->
    </header>
  </a>
  <nav>
    <a href="/">Blog</a>
    <a href="http://bandcamp.ochremusic.com/" title="To Bandcamp!">Music</a>
    <a href="/mastering/">Mastering</a>
    <a href="/portfolio/">Portfolio</a>
    <a href="/merch/">Merch</a>
    <a href="/biography/">Biography</a>
    <a href="/contact/">Contact</a>
  </nav>

<div id="wrapper">
  <section>
    <span class="entry-title">Replacing video audio using ffmpeg</span>
    <div class="entry-meta">
      <span class="date">
        <a href="" title="Permalink">5 July 2016</a>
      </span>
    </div>
    <p>Up until recently I used Quicktime to switch audio tracks for the odd music and showreel video, but since it will no longer be updated for Windows, and can possibly lead to your PC getting the clap, I figured I'd better find an alternative option. Enter <a href="https://www.ffmpeg.org/">ffmpeg</a>. It's a very powerful, free command line tool that I'd previously only worked with in tandem with some sort of GUI or partner app, and had never really tried to work with it on its own due to its bewildering plethora of options. But after a little trial and error I've settled on the following commands to replace audio streams in video files, (re)encoding where necessary, and avoiding video transcoding if possible in order to retain video image quality.</p>
<p><!--more--></p>
<p>I installed ffmpeg using <a href="https://chocolatey.org/">Chocolatey</a>, a very useful package manager for Windows, similar in operation to those you'd find on Linux (well, it's not quite as good as APT or DNF/YUM, say, but it's the best we've got at the moment).</p>
<p>In Windows 10, you can shift-right click in the Explorer directory that houses your video file to open a command window (just select the very handy 'Open command window here' option).</p>
<p>Firstly, if you'd like to strip the audio from a video file, you can use this command:</p>
<p><code>ffmpeg -i INPUT.mp4 -codec copy -an OUTPUT.mp4</code></p>
<p>Specifying the INPUT and OUTPUT files accordingly, with file extension (needless to say, it doesn't have to be .mp4).<br />
<code>-i</code> precedes the file you wish to strip the audio from.<br />
<code>-codec copy</code> is to send the video stream to the output file without transcoding, which will maintain video quality, as well as save you loads of time not having to crunch video.<br />
<code>-an</code> will remove the audio file. Similarly, you could use <code>-vn</code> to remove a video stream instead.</p>
<p>Then you can add your audio track by typing:</p>
<p><code>ffmpeg -i INPUT.mp4 -i AUDIO.wav -shortest -c:v copy -c:a aac -b:a 256k OUTPUT.mp4</code></p>
<p>As you can see, I have two input streams to be muxed together, the silent video file and the audio wav, to the output file at the end of the command. But there are a couple of other handy commands involved this time.</p>
<p><code>-c</code> is a shorthand of the <code>-codec</code> command we used in the first example, and is used here to specify the audio and video codecs individually. As before, the video is passed through, but I've chosen to encode the audio as an aac file instead of simply adding the wav audio to the video, and have specified the audio bitrate using <code>-b:a</code>.</p>
<p>The <code>-shortest</code> option will truncate whichever stream between the audio and video is longest down to the length of the shortest. This is handy for crudely chopping audio down to the video length, say.</p>
<p>So far so good, but you might be wondering if you can just combine those two commands into a single command for even quicker results. Absolutely:</p>
<p><code>ffmpeg -i INPUT.mp4 -i AUDIO.wav -map 0:0 -map 1:0 -c:v copy -c:a aac -b:a 256k -shortest OUTPUT.mp4</code></p>
<p>This time we use the <code>-map</code> commands to specify which streams from the input files respectively should be included the output file. Any stream not explicitly specified will be ignored. I <em>think</em> the left side of the map option denotes the input file index (according to the order in which they were typed in the command), and the right side is the stream ID within the file. You can always check the stream IDs by running ffmpeg specifying only an input file and no output, which will just list all the streams in the media file. Similarly, you could also check the streams in something like VideoLAN, too.</p>
<p>Anyway, I hope this post is useful. If nothing else, it's a good way for me to consolidate tips for myself (isn't that termed 'Ako', or something?) and help me remember for future use.</p>

  </section>
  <aside>
  <a href="https://play.spotify.com/artist/0OmHDBh5styCXDWKwz58Ts"><h3 class="spotify">Spotify</h3></a>
  <p><iframe src="https://embed.spotify.com/follow/1/?uri=spotify:artist:0OmHDBh5styCXDWKwz58Ts&size=basic&theme=light" width="200" height="25" scrolling="no" frameborder="0" style="border:none; overflow:hidden;" allowtransparency="true"></iframe></p>
  <h3 class="newsletter">Newsletter</h3>
  <p><a href="http://eepurl.com/c9Kck">Sign up</a> to be notified about new releases as soon as theyâ€™re available.</p>
  <!-- Begin MailChimp Signup Form -->
  <div id="mc_embed_signup">
    <form action="//ochremusic.us2.list-manage.com/subscribe/post?u=151ec83f4c25861e18b82743a&amp;id=356ce80316" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
      <div id="mc_embed_signup_scroll">

        <div class="mc-field-group">
          <input type="email" placeholder="Email (required)" value="" name="EMAIL" class="required email" id="mce-EMAIL" required>
        </div>
        <div class="mc-field-group">
          <input type="text" placeholder="First Name" value="" name="FNAME" class="" id="mce-FNAME">
        </div>
        <div class="mc-field-group">
          <input type="text" placeholder="Last Name" value="" name="LNAME" class="" id="mce-LNAME">
        </div>
        <div id="mce-responses" class="clear">
          <div class="response" id="mce-error-response" style="display:none"></div>
          <div class="response" id="mce-success-response" style="display:none"></div>
        </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
        <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_151ec83f4c25861e18b82743a_356ce80316" tabindex="-1" value=""></div>
        <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
      </div>
    </form>
  </div>

  <!--End mc_embed_signup-->
  <h3 class="shows">Shows</h3>
  <p></p>
  <script src="//widget.songkick.com/widget.js"></script></a>
  <script src="//widget.songkick.com/widget.js"></script></p>
  <h3 class="tips">Tip Jar</h3>
  <p><a href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=35LBJAP4KGZNW">Tip via PayPal</a>. All tips very gratefully received.</p>
  <h3 class="links">Links</h3>
  <ul>
    <li><a href="https://play.spotify.com/artist/0OmHDBh5styCXDWKwz58Ts">Spotify</a></li>
    <li><a href="http://ochre.bandcamp.com/">Bandcamp</a></li>
    <li><a href="https://itunes.apple.com/us/artist/ochre/id84229320">iTunes</a></li>
    <li><a href="http://soundcloud.com/ochre">SoundCloud</a></li>
    <li><a href="https://twitter.com/ochremusic">Twitter</a></li>
    <li><a href="https://www.facebook.com/ochremusic">Facebook</a></li>
    <li><a href="https://amazingtunes.com/ochre">Amazing Tunes</a></li>
    <li><a href="http://www.discogs.com/artist/Ochre">Discogs</a></li>
    <li><a href="https://www.youtube.com/user/ochremusic">YouTube</a></li>
    <li><a href="http://melograf.com/">Melograf Mastering</a></li>
    <li><a href="http://nkurence.com/">nkurence</a></li>
  </ul>
</aside>

</div>
<footer>
  <p>&copy; 2009&ndash;2016 Christopher Scott Leary</p>
  <a href="https://twitter.com/ochremusic"><span class="genericon genericon-twitter"></span></a>
  <a href="https://facebook.com/ochremusic"><span class="genericon genericon-facebook"></span></a>
</footer>
</body>

</html>

